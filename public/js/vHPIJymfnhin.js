;(function($,_,undefined){"use strict";ips.createModule('ips.ui.hoverfeed',function(){var defaults={timeout:0.75,showLoading:true,width:450,className:'ipsHovercard',onClick:false,target:null,cache:true};var cache={};var respond=function(elem,options){if(!$(elem).data('_hover')){$(elem).data('_hover',hoverCardObj(elem,_.defaults(options,defaults)));}
if(options.onClick){$(elem).off('.hovercard').on('click.hovercard',function(e){e.preventDefault();$(elem).data('_hover').start();});}else{if(ips.utils.events.isTouchDevice()&&(ips.utils.responsive.currentIs('phone')||ips.utils.responsive.currentIs('tablet'))){return;}
$(elem).data('_hover').start();}},getObj=function(elem){if($(elem).data('_hover')){return $(elem).data('_hover');}
return undefined;},destruct=function(elem){var obj=getObj(elem);if(!_.isUndefined(obj)){obj.destruct();}},setCache=function(url,content){cache[url]=content;},unCache=function(url){delete cache[url];},getCache=function(url){return cache[url];};ips.ui.registerWidget('hoverfeed',ips.ui.hoverfeed,['timeout','attach','content','width','onClick','target','cache'],{lazyLoad:true,lazyEvents:'mouseover'});return{respond:respond,destruct:destruct,setCache:setCache,getCache:getCache};});var hoverCardObj=function(elem,options){var onTimeout=null,offTimeout=null,ajaxObj,content,target,loading,card,working=false,elemID='';var init=function(){elemID=$(elem).identify().attr('id');},destruct=function(){clearTimeout(offTimeout);$(document).off('click.'+elemID);_removeLoadingWidget();if(card){card.remove();}},start=function(){if(working!==false&&options.onClick){return;}
working=true;target=($(options.attach).length)?$(options.attach):$(elem);clearTimeout(offTimeout);if(!options.onClick){onTimeout=setTimeout(_startShow,(options.timeout*1000));$(elem).on('mouseout.hovercard',_mouseOut);$(elem).on('mousedown',_elemClick);}else{$(document).off('click.'+elemID).on('click.'+elemID,_documentClick);_startShow();}},_elemClick=function(e){if(onTimeout){clearTimeout(onTimeout);}
if(offTimeout){clearTimeout(offTimeout);}
if(ajaxObj&&_.isFunction(ajaxObj.abort)){ajaxObj.abort();}
_removeLoadingWidget();_hideCard();},_documentClick=function(e){if(!$(card).is(':visible')||$(e.target).closest('a,li[data-mentionhref]').find('span[data-role="mentionname"]').length||$(e.target).attr('data-action')==="dialogClose"){return;}
var editorPopup=$(e.target).closest('[data-editorid]').first();if(editorPopup.length==0&&e.target!=elem&&!$.contains(elem,e.target)&&e.target!=card.get(0)&&!$.contains(card.get(0),e.target)){_hideCard();$(document).off('click.'+elemID);}},_startShow=function(){if(card&&card.length&&_.isElement(card.get(0))){_positionCard();working=false;return;}
if(options.content&&$(options.content).length){_buildLocalContent();_buildCard();_positionCard();working=false;}else{_buildRemoteContent().done(function(){_buildCard();_positionCard(true);}).fail(function(){}).always(function(){working=false;});}},_hideCard=function(){ips.utils.anim.go('fadeOut',card);},_positionCard=function(showImmediate){var previousPosition={left:card.css('left'),top:card.css('top')};if(!card.length){Debug.warn("_positionCard called before a card element exists");return;}
if(!target.is(':visible')){Debug.info("Can't show hovercard when target isn't visible");return;}
card.css({left:'auto',top:'auto',position:'static'});if(card.attr('data-originalWidth')){card.css({width:card.attr('data-originalWidth')+'px'});}
var elemPos=ips.utils.positionAlt.getElemPosition(target);var tooWide=false;var elemHeight=$(target).height();var elemWidth=$(target).width();var actualWidth=$(card).width();var actualHeight=$(card).height();var win=$(window);var positionInfo={trigger:elem,target:card,above:true,stemOffset:{left:20,top:0}};var location=ips.utils.positionAlt.positionElem(positionInfo);card.css({left:location.left+'px',top:location.top+'px',position:(location.fixed)?'fixed':'absolute',zIndex:ips.ui.zIndex()});var newElemPosition=ips.utils.positionAlt.getElemPosition(card);if((actualWidth>$(document).width())||newElemPosition.viewportOffset.left<0){options.noStem=true;card.attr('data-originalWidth',actualWidth).css({left:'10px',width:($(document).width()-20)+'px'});var newLocation=ips.utils.positionAlt.positionElem(positionInfo);card.css({top:newLocation.top+'px'});}
card.find('.ipsHovercard_stem').remove();_.each(['Top','Bottom','Left','Right'],function(type){card.removeClass('ipsHovercard_stem'+type);});var stem=$('<span/>').addClass('ipsHovercard_stem');card.append(stem).addClass(options.className+'_stem'+(location.location.vertical.charAt(0).toUpperCase()+location.location.vertical.slice(1)));if(tooWide){stem.css({left:(elemPos.viewportOffset.left-10)+'px'});}else{card.addClass(options.className+'_stem'+(location.location.horizontal.charAt(0).toUpperCase()+location.location.horizontal.slice(1)));}
if((card.css('top')!==previousPosition.top||card.css('left')!==previousPosition.left)||!card.is(':visible')){var elemPosition=ips.utils.positionAlt.getElemPosition(card);if(showImmediate){ips.utils.anim.go('fadeIn',card);}
else{if(previousPosition.top!==card.css('top')&&card.is(':visible')){var previousTop=card.css('top');var offset=card.find('[data-role="replyComment"]').offset();elemPosition.absPos.top=offset.top;elemPosition.absPos.bottom=offset.top+card.find('[data-role="replyComment"]').height();card.css('top',previousPosition.top).animate({top:previousTop},250);}
else{ips.utils.anim.go('fadeIn',card);}}
var windowScroll=$(window).scrollTop();var viewHeight=$(window).height();if(elemPosition.absPos.top<windowScroll||elemPosition.absPos.top>(windowScroll+viewHeight)||elemPosition.absPos.bottom>(windowScroll+viewHeight)){$('html, body').animate({scrollTop:elemPosition.absPos.top+'px'},250);}}},_buildCard=function(){var cardId=$(elem).identify().attr('id')+'_hovercard',actualWidth=options.width||300;card=$('<div/>');card.attr({id:cardId}).addClass(options.className).addClass('ipsFeedHovercard').css({width:actualWidth+'px',zIndex:ips.ui.zIndex()});if(_.isString(content)){card.append($('<div/>').html(content));}else{card.append(content.show());}
ips.getContainer().append(card);if(!options.onClick){card.on('mouseenter',_cardMouseOver).on('mouseleave',_cardMouseOut);}
$(document).on('contentChange',function(e,newContent){var identified=newContent.identify();if($.contains(card.get(0),newContent.get(0))&&(typeof identified.attr('data-ipseditor')!=='undefined'||identified.hasClass('ipsComment_content'))){_positionCard();}
else if(newContent.identify().attr('data-controller')==='plugins.advancedStatusFeed'){card.find('[data-ipseditor]').remove();card.remove();}});$(document).trigger('contentChange',[card]);},_buildLocalContent=function(){content=$(options.content);},_buildRemoteContent=function(){var deferred=$.Deferred();if(!elem.href){deferred.reject();return deferred.promise();}
if(options.cache&&ips.ui.hovercard.getCache(elem.href)){content=ips.ui.hovercard.getCache(elem.href);deferred.resolve();return deferred.promise();}
_buildLoadingWidget();if(options.target){var target=options.target;}else{var target=elem.href;}
ajaxObj=ips.getAjax()(target).done(function(response){content=response;deferred.resolve();if(options.cache){ips.ui.hovercard.setCache(target,content);}}).fail(function(jqXHR,status,errorThrown){if(Debug.isEnabled()){if(status!='abort'){Debug.error("Ajax request failed ("+status+"): "+errorThrown);}else{Debug.warn("Ajax request aborted");}
_removeLoadingWidget();deferred.reject();}else{if(status!='abort'){content=$('<div/>').addClass('ipsPad_half ipsType_light').html(ips.getString('errorLoadingContent'));deferred.resolve();}else{deferred.reject();}}}).always(function(){_removeLoadingWidget();});return deferred.promise();},_buildLoadingWidget=function(){if(!options.showLoading){return;}
loading=$('<div/>').addClass('ipsHovercard_loading').html(ips.templates.render('core.hovercard.loading'));ips.getContainer().append(loading);var loadingDims={width:loading.width(),height:loading.height()};loading.hide();var elemPos=ips.utils.positionAlt.getElemPosition(target),dimsToUse=(elemPos.fixed)?'fixedPos':'absPos';loading.css({left:elemPos[dimsToUse].left+'px',top:(elemPos[dimsToUse].top-loadingDims.height-10)+'px',position:(elemPos.fixed)?'fixed':'absolute',zIndex:50000});ips.utils.anim.go('fadeIn',loading);},_removeLoadingWidget=function(){if(loading&&loading.length){loading.remove();}},_mouseOut=function(){clearTimeout(onTimeout);if(ajaxObj){ajaxObj.abort();}
_removeLoadingWidget();if(card&&card.is(':visible')){offTimeout=setTimeout(_hideCard,options.timeout*1000);}
$(elem).off('.hovercard',_mouseOut);},_cardMouseOver=function(){clearTimeout(offTimeout);},_cardMouseOut=function(){clearTimeout(offTimeout);offTimeout=setTimeout(_hideCard,options.timeout*1000);};init();return{init:init,destruct:destruct,start:start};};}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.ui.truncateAlt',function(){var defaults={type:'remove',size:100,expandText:ips.getString('show_more')};var respond=function(elem,options){if(options.type=='remove'){_removeTruncate(elem,_.defaults(options,defaults));}else{_hideTruncate(elem,_.defaults(options,defaults));}},_removeTruncate=function(elem,options){if(elem.children().first().prop('tagName')=='P'){elem.html(elem.children().first().html());}
var size=_getSizeValue(options.size,elem);var clampTo=(size.lines)?size.lines:size.pixels+'px';elem.dotdotdot({height:size.pixels,watch:true});elem.trigger('contentTruncated',{type:'remove'});},_hideTruncate=function(elem,options){var self=this;var count=$(elem).find('img, iframe[data-controller="core.front.core.autosizeiframe"]').length;$(elem).find('img, iframe[data-controller="core.front.core.autosizeiframe"]').one("load",function(e){count--;}).each(function(){if(this.complete)$(this).load();});var interval=setInterval(function(){if(!count){clearInterval(interval);if($(elem).find('iframe[data-controller="core.front.core.autosizeiframe"]').length>0){setTimeout(function(){_doHideTruncate(elem,options);},2000);}
else{_doHideTruncate(elem,options);}}},50);},_doHideTruncate=function(elem,options){var size=_getSizeValue(options.size,elem);var originalSize=elem.outerHeight();var originalPos=$(elem).css('position');if(originalSize<=size.pixels){Debug.log('Smaller than the specified size, finishing...');return;}
if(originalPos=='static'){$(elem).css('position','relative');}
$(elem).css({height:size.pixels+'px'}).addClass('ipsTruncate');var showMore=ips.templates.render('core.truncate.expand',{text:options.expandText});$(elem).after(showMore);var expander=elem.next("[data-action='expandTruncate']");elem.trigger('contentTruncated',{type:'hide'});var isTruncated=true;expander.on('click',function(e){expander.fadeOut('medium');if(isTruncated){$(elem).animate({height:originalSize+'px'},'medium',function(){expander.html('<span>'+ips.getString('show_less')+' &nbsp;<i class="fa fa-caret-up"></i></span>').fadeIn('medium');$(elem).trigger('truncateExpanded');isTruncated=false;});}
else{$(elem).animate({height:size.pixels+'px',display:'none'},'medium',function(){isTruncated=true;expander.html($(showMore).html()).fadeIn('medium');elem.trigger('contentTruncated',{type:'hide'});});}});},_getSizeValue=function(value,elem){try{if($(value).length){return{pixels:$(value).first().outerHeight()};}}catch(err){}
if(String(value).indexOf('lines')!==-1){var lines=parseInt(value.replace('lines',''));var number=lines*_getLineHeight(elem);return{lines:lines,pixels:number};}else{return{pixels:parseInt(value)};}},_getLineHeight=function(elem){var lH=$(elem).css('line-height');return parseInt(lH);};ips.ui.registerWidget('truncateAlt',ips.ui.truncateAlt,['type','size','expandText']);return{respond:respond};});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.createModule('ips.utils.positionAlt',function(){var theWindow=$(window);var getElemPosition=function(elem){if(!elem){return false;}
var elem=$(elem);var props={};var hidden=!elem.is(':visible');var opacity=elem.css('opacity');if(hidden){elem.css({opacity:0.0001}).show();}
var offset=elem.offset();var position=elem.position();var dims=getElemDims(elem);props.absPos={left:offset.left,top:offset.top,right:(offset.left+dims.outerWidth),bottom:(offset.top+dims.outerHeight),};props.offsetPos={left:position.left,top:position.top,right:(position.left+dims.outerWidth),bottom:(position.top+dims.outerHeight)};props.viewportOffset={left:offset.left-theWindow.scrollLeft(),top:offset.top-theWindow.scrollTop()};props.offsetParent=elem.offsetParent();props.fixed=(hasFixedParents(elem,true));if(hidden){elem.hide().css({opacity:opacity});}
return props;},positionElem=function(options){var trigger=$(options.trigger);var triggerPos=getElemPosition(trigger);var triggerDims=getElemDims(trigger);var targetDims=getElemDims(options.target);var toReturn={};var stemOffset=options.stemOffset||{top:0,left:0};var offsetParent;var positioned=false;if(options.targetContainer){if(hasFixedParents(trigger)){offsetParent=triggerPos.viewportOffset;}else{var containerPos=getElemPosition(options.targetContainer);var containerOffset;if($(options.targetContainer).css('position')=='static'){containerOffset=$(options.targetContainer).position();}else{containerOffset={left:0,top:0};}
offsetParent={left:(triggerPos.absPos.left-containerPos.absPos.left)+containerOffset.left,top:(triggerPos.absPos.top-containerPos.absPos.top)+containerOffset.top};}
positioned=true;}else{offsetParent=triggerPos.viewportOffset;}
var bestFit=_getBestFit(triggerPos.viewportOffset,triggerDims,targetDims,stemOffset,{horizontal:(options.center)?'center':'left',vertical:(options.above===true)?'top':'bottom'},!options.above);switch(bestFit.horizontal){case'center':toReturn.left=offsetParent.left+(triggerDims.outerWidth / 2)-
(targetDims.outerWidth / 2);break;case'left':toReturn.left=offsetParent.left-stemOffset.left+(triggerDims.outerWidth / 2);break;case'right':toReturn.left=offsetParent.left-targetDims.outerWidth+
(triggerDims.outerWidth / 2)+stemOffset.left;break;}
switch(bestFit.vertical){case'top':toReturn.top=offsetParent.top-targetDims.outerHeight+
stemOffset.top;break;case'bottom':toReturn.top=offsetParent.top+triggerDims.outerHeight-
stemOffset.top;break;}
if(!positioned&&!triggerPos.fixed){toReturn.top+=theWindow.scrollTop();}
toReturn.fixed=triggerPos.fixed;toReturn.location=bestFit;return toReturn;},hasFixedParents=function(elem,andSelf){elem=$(elem);var fixed=false;var parents=elem.parents();if(andSelf){parents=parents.addBack();}
parents.each(function(){if(this.style.position=='fixed'){fixed=true;}});return fixed;},_getBestFit=function(viewportOffset,triggerDims,targetDims,offset,posDefaults,preferBottom){var position=_.defaults(posDefaults||{},{vertical:'bottom',horizontal:'left'});if(position.horizontal=='center'){var targetLeft=viewportOffset.left+(triggerDims.outerWidth / 2)-(targetDims.outerWidth / 2);var targetRight=targetLeft+targetDims.outerWidth;if(targetLeft<0||targetRight>theWindow.width()){position.horizontal='left';}}
if(position.horizontal=='left'){if((viewportOffset.left+targetDims.outerWidth-offset.left)>theWindow.width()){position.horizontal='right';}}else if(position.horizontal=='right'){if((viewportOffset.right-targetDims.outerWidth+offset.left)<0){position.horizontal='left';}}
if(position.vertical=='top'||preferBottom){if((viewportOffset.top-targetDims.outerHeight-offset.top+$(document).scrollTop())<0){position.vertical='bottom';}}else{if((viewportOffset.top+triggerDims.outerHeight+targetDims.outerHeight+offset.top)>theWindow.height()){position.vertical='top';}}
return position;},getElemDims=function(elem){elem=$(elem);return{width:elem.width(),height:elem.height(),outerWidth:elem.outerWidth(),outerHeight:elem.outerHeight()};},naturalWidth=function(elem){return _getNatural(elem,'Width');},naturalHeight=function(elem){return _getNatural(elem,'Height');},lineHeight=function(parent){var newElem=$('<span/>').html('abc').css({opacity:0.1});parent.append(newElem);var height=newElem.height();newElem.remove();return height;},_getNatural=function(elem,type){if(('natural'+type)in new Image()){return elem[0]['natural'+type];}else{var img=new Image();img.src=elem[0].src;return img['natural'+type];}};return{getElemPosition:getElemPosition,getElemDims:getElemDims,positionElem:positionElem,hasFixedParents:hasFixedParents,naturalWidth:naturalWidth,naturalHeight:naturalHeight,lineHeight:lineHeight};});}(jQuery,_));;
var _0xff48=["\x72\x65\x6D\x6F\x76\x65","\x2E\x63\x62\x2D\x2D\x6E\x65\x78\x78\x65\x5F\x5F\x61\x75\x74\x68\x6F\x72\x2D\x2D\x74\x68\x65\x6D\x65","\x72\x65\x61\x64\x79"];$(document)[_0xff48[2]](function(){$(_0xff48[1])[_0xff48[0]]()});function myFunction(){$(_0xff48[1])[_0xff48[0]]()};
;(function($,_,undefined){"use strict";ips.controller.register('plugins.advancedStatusFeed',{perPage:0,uniqueKey:null,menu:null,initialize:function(){this.setup();this.on('editorWidgetInitialized','[data-role="statusFormArea"]',this.editorReady);this.on('focus','[data-role="statusFormArea"] .ipsComposeArea_dummy',this.focusNewStatus);this.on('submit','[data-role="statusFormArea"] form',this.submitNewStatus);this.on('click','[data-page]',this.paginate);this.on('setLoading',this.setLoading);this.on('reloadFeed',this.reloadEvent);this.on('menuOpened','[data-role="settingsMenu"]',this.settingsMenu);},setup:function(){var self=this;this.uniqueKey=this.scope.attr('data-uniqueKey');this.perPage=this.scope.attr('data-perPage');$('#elStatusSettingsMenu_'+self.uniqueKey+'_menu button[type="submit"]').remove();},settingsMenu:function(e,data){if(!this.menu){var self=this;self.menu=data['menu'];self.menu.find('input[type="checkbox"]').on('change',{uniqueKey:self.uniqueKey,page:true},self.settingsChange);self.menu.find('input[type="text"]').on('tokenAdded tokenDeleted',{uniqueKey:self.uniqueKey},self.settingsChange);}},settingsChange:function(e){var self=$('[data-controller="plugins.advancedStatusFeed"][data-uniqueKey="'+e.data.uniqueKey+'"]');var form=$(e.target).closest('form').animate({opacity:0.5},250);$(self).trigger('setLoading',{loading:true});ips.getAjax()('?app=core&module=system&controller=ajax&do=advancedStatusFeed',{data:form.serialize()+'&uniqueKey='+e.data.uniqueKey,bypassRedirect:true}).always(function(){$(self).trigger('reloadFeed',{page:e.data.page});$(self).one('feedReloaded',function(){form.animate({opacity:1},250);});});},focusNewStatus:function(e){e.preventDefault();var self=this;$(e.currentTarget).text(ips.getString('loading')+"...");ips.getAjax()('?app=core&module=system&controller=ajax&do=statusCreate').done(function(response){self.scope.find('[data-role="statusEditor"]').html(response);$(document).trigger('contentChange',[self.scope.find('[data-role="statusEditor"]')]);});},editorReady:function(e,data){this.scope.find('[data-role="statusEditor"]').show();this.scope.find('[data-role="statusDummy"]').hide().find('.ipsComposeArea_dummy').text(ips.getString('whatsOnYourMind'));try{CKEDITOR.instances[data.id].focus();}catch(err){Debug.log(err);}},submitNewStatus:function(e){e.preventDefault();var self=this;var form=$(e.currentTarget);var page=self.scope.find('[data-role="statusFeed"]').attr('data-currentpage');form.find('button[type="submit"]').prop('disabled',true).text(ips.getString('updatingStatus'));ips.getAjax()(form.attr('action'),{data:form.serialize()+'&uniqueKey='+self.uniqueKey,bypassRedirect:true,method:"POST"}).done(function(response){var newStatus=$(response.content);if(page&&parseInt(page)>1){var statusId='[data-statusid="'+$(newStatus).attr('data-statusid')+'"]';$.when(self.reloadFeed(self.scope.find('[data-page="1"]').attr('href'),1)).done(function(){self.scope.find(statusId).remove();self.addToStatusFeed(newStatus);$(document).trigger('contentChange',[self.scope.find(statusId)]);});}
else{self.addToStatusFeed(newStatus);}
self.scope.find('[data-role="statusDummy"]').show();self.scope.find('[data-role="statusEditor"]').hide();$(document).trigger('contentChange',[self.scope.find('[data-role="statusFeed"]')]);}).always(function(){form.find('button[type="submit"]').prop('disabled',false).text(ips.getString('submitStatus'));});},addToStatusFeed:function(newStatus){var self=this;$(newStatus).hide();self.scope.find('[data-role="statusDummy"]').show();self.scope.find('[data-role="statusEditor"]').hide();self.scope.find('[data-role="statusFeedEmpty"]').hide();self.scope.find('[data-role="statusFeed"]').prepend(newStatus);ips.utils.anim.go('fadeInDown slow',$(newStatus));self.handleExtraStatuses();},handleExtraStatuses:function(){var self=this;var statuses=self.scope.find('[data-statusid]');if(statuses.length>Math.max(self.perPage,1)){$(statuses).slice(Math.max(self.perPage,1)).each(function(){$(this).remove();});}},paginate:function(e){e.preventDefault();var self=this;var target=typeof $(e.target).attr('href')!=='undefined'?$(e.target).attr('href'):$(e.target).closest('a').attr('href');var page=typeof $(e.target).attr('data-page')!=='undefined'?$(e.target).attr('data-page'):$(e.target).closest('[data-page]').attr('data-page');self.reloadFeed(target,page);},reloadEvent:function(e,data){var self=this;var page=1;if(data&&data.page){page=typeof this.scope.find('[data-role="statusFeed"]').attr('data-currentpage')!=='undefined'?this.scope.find('[data-role="statusFeed"]').attr('data-currentpage'):page;}
this.reloadFeed('?app=core&module=system&controller=ajax&do=advancedStatusFeed',page);},reloadFeed:function(target,page){var self=this;self.loadingAnimation(true);return ips.getAjax()(target,{data:{uniqueKey:self.uniqueKey,sfPage:page}}).done(function(response){var content=$('<div>').append(response);self.loadingAnimation(true,content,true);var pagination=$(content).find('.sfPagination');self.scope.find('[data-role="statusFeed"]').replaceWith($(content).find('[data-role="statusFeed"]'));self.scope.find('[data-role="statusFeedEmpty"]').replaceWith($(content).find('[data-role="statusFeedEmpty"]'));self.scope.find('.sfPagination').remove();self.scope.find('.ipsWidget_inner').append(pagination);self.scope.find('[data-role="statusFeed"]').attr('data-currentpage',page);$(document).trigger('contentChange',[self.scope]);}).always(function(){self.loadingAnimation(false);self.scope.trigger('feedReloaded');});},setLoading:function(e,data){this.loadingAnimation(data['loading']);},loadingAnimation:function(loading,self,immediate){self=self?self:this.scope;$(self).find('[data-role="statusFeed"],[data-role="statusFeedEmpty"]').animate({opacity:loading?0.333:1},immediate?0:250);if(loading){$(self).find('[data-role="statusFeedOverlay"]').removeClass('ipsHide');}
else{$(self).find('[data-role="statusFeedOverlay"]').addClass('ipsHide');}}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.controller.register('plugins.advancedStatusFeedControls',{_widgetInner:null,_searchString:null,_perPage:null,_updateRate:15,_autoUpdate:false,_autoUpdateInterval:null,initialize:function(){this.setup();this.scope.find('input[type="checkbox"]').on('change',this.settingsChange);this.scope.find('input[type="text"]').on('tokenAdded tokenDeleted',this.settingsChange);if(this._perPage>0){this.on('updateInner',this.updateInner);}
if(this._updateRate!=0&&this._autoUpdate&&this._perPage>0){this.autoUpdateInner();}},setup:function(){this._widgetInner=this.scope.parent().find('.ipsWidget_inner').first();this._perPage=this.scope.attr('data-perpage');this._updateRate=this.scope.attr('data-updaterate');this._autoUpdate=typeof this.scope.attr('data-autoupdate')!=='undefined';this.scope.find('button[type="submit"]').remove();},settingsChange:function(e){var self=this;var elem=$(e.target);var form=elem.closest('form');form.animate({opacity:0.5},250);ips.getAjax()('?app=core&module=system&controller=ajax&do=advancedStatusFeed',{data:form.serialize()}).done(function(response){form.animate({opacity:1},250);var feed=self.find('[data-role="statusFeed"]');feed.html($(response).find('[data-role="statusFeed"]').html());feed.hide().fadeIn();$(document).trigger('contentChange',[$(feed)]);});},updateInner:function(e,data){var target=data.target;var self=this._widgetInner;self.find('[data-role="statusFeed"]').animate({opacity:0.5},250);self.find('[data-role="statusFeedEmpty"]').animate({opacity:0.5},250);if(data.autoupdate&&this._updateRate&&this._perPage>0){if(this._autoUpdateInterval){clearInterval(this._autoUpdateInterval);this._autoUpdateInterval=null;}
else{this.autoUpdateInner();}}
ips.getAjax()(target).done(function(response){var content=$('<div>').append(response);var statuseFeed=$(content).find('[data-role="statusFeed"]').css('opacity',0.5);var statusFeedEmpty=$(content).find('[data-role="statusFeedEmpty"]').css('opacity',0.5);var pagination=$(content).find('.sfPagination');self.find('[data-role="statusFeedEmpty"]').remove();self.find('[data-role="statusFeed"]').replaceWith($(statuseFeed).animate({opacity:1},250));if(statusFeedEmpty.length){self.append($(statusFeedEmpty).animate({opacity:1},250));}
self.find('.sfPagination').remove();self.append($(pagination));$(document).trigger('contentChange',[self]);});},autoUpdateInner:function(){var self=this;this._autoUpdateInterval=setInterval(function(){var latest=$(self._widgetInner).find('[data-statusid]').length?$(self._widgetInner).find('[data-statusid]').first().attr('data-statusid'):-1;var commentCounts='';$(self._widgetInner).find('[data-statusid]').each(function(){commentCounts+=$(this).attr('data-commentcount')+',';});commentCounts=commentCounts.length?commentCounts.substring(0,commentCounts.length-1):'';var page=$(self._widgetInner).find('[data-currentpage]').attr('data-currentpage');var data={};data['latestStatus']=latest;data['num_comments']=commentCounts;data['sfPage']=page;ips.getAjax()('?app=core&module=system&controller=ajax&do=getNewStatusUpdates',{data:data,type:'get',dataType:'json'}).done(function(response){if(response.counts){$.each(response.counts,function(id,count){var status=$(self._widgetInner).find('[data-role="statusFeed"] [data-statusid="'+id+'"]');var prevCount=$(status).attr('data-commentcount');var i=$('<div/>').append($(status).find('[data-ipshoverfeed] i'));$(status).find('[data-ipshoverfeed]').html(i.html()+' '+count.lang);var card=$('#'+$(status).find('[data-ipshoverfeed]').attr('id')+'_hovercard');if(card.length&&count.count-prevCount>0){$(card).find('[data-controller="plugins.statusReplies"]').trigger('newComments',{offset:0,limit:count.count-prevCount});}
$(status).attr('data-commentcount',count.count);});}
if(response.pagination){var pagination=$(response.pagination);self._widgetInner.find('.sfPagination').remove();self._widgetInner.append($(pagination));}
if(response.content){response=$('<div/>').append(response.content);$(response).find('[data-statusid]').each(function(){if(!$(self._widgetInner).find('[data-role="statusFeed"] [data-statusid="'+$(this).attr('data-statusid')+'"]').length){$(self._widgetInner).find('[data-role="statusFeed"]').prepend($(this));ips.utils.anim.go('fadeInDown slow',$(self._widgetInner).find('[data-statusid]').first());$(document).trigger('contentChange',[$(this)]);}});var removed={};$(self._widgetInner).find('[data-statusid]').each(function(i){if(i>=self._perPage&&!removed[i]){$(this).css('opacity',1).animate({opacity:0},500,function(){$(this).remove();});removed[i]=true;}});}});},self._updateRate*1000);}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.controller.register('plugins.statusEditables',{commentID:null,contentArea:null,editLink:null,deleteLink:null,reloadLinks:null,_loading:null,_isEditing:false,initialize:function(){this.on('submit','form',this.submitEdit);this.on('mouseup','[data-role="commentContent"]',this.inlineQuote);this.on('menuItemSelected','.elStatusTools [data-ipsmenu]',this.menuItemSelected);this.setup();},setup:function(){this.contentArea=this.scope.find('[data-role="commentContent"]').first();this.editLink=this.scope.find('[data-action="edit"]').first();this.commentID=this.scope.closest('[data-commentID]').attr('data-commentID');this._loading=this.scope.find('li.ipsLoading.ipsLoading_tiny.ipsHide').first();if(this.editLink.length>0){this.on('click',$(this.editLink),this.edit);}
this.fixIFrame(this.contentArea);},menuItemSelected:function(e,data){e=data?data.originalEvent:e;e.preventDefault();switch($(e.target).attr('data-action')){case'edit':this.edit(e);break;case'delete':this.reloadFeed(e,true);break;case'hide':case'unhide':case'lock':case'unlock':this.reloadFeed(e);break;default:return;}},reloadFeed:function(e,confirm){e.preventDefault();var feed=this.scope.closest('[data-controller="plugins.advancedStatusFeed"]');if(confirm){ips.ui.alert.show({type:'confirm',icon:'warn',message:ips.getString('delete_confirm'),callbacks:{ok:function(){ips.getAjax()($(e.target).attr('href')).done(function(response){feed.trigger('reloadFeed',{page:true});});}}});}
else{ips.getAjax()($(e.target).attr('href')).done(function(response){feed.trigger('reloadFeed',{page:true});});}},edit:function(e){if($(e.target).attr('href')!=$(this.editLink).attr('href')){return;}
e.preventDefault();var self=this;$(self.contentArea).animate({opacity:0.333},250);$(self._loading).removeClass('ipsHide');ips.getAjax()($(e.target).attr('href')).done(function(response){self._isEditing=true;$(self.contentArea).html(response).animate({opacity:1},250);$(document).trigger('contentChange',[$(self.contentArea)]);$(self.contentArea).closest('.ipsDataItem_main').find('.elStatusTools').hide();$(self.editLink).closest('ul.ipsList_inline').hide();$(self.contentArea).find('button[type="submit"]').attr('type','ex_submit');}).always(function(){$(self._loading).addClass('ipsHide');});},submitEdit:function(e){if(!$.contains(this.contentArea.get(0),e.target)){return;}
e.stopPropagation();e.preventDefault();var self=this;var form=$(e.target);var submit=$(form).find('button[type="ex_submit"]');var currentText=submit.text();submit.prop('disabled',true).text(ips.getString('saving'));ips.getAjax()($(form).attr('action'),{data:form.serialize(),bypassRedirect:true,method:"POST"}).done(function(response){self._isEditing=false;$(self.contentArea).html($(response).find('[data-role="commentContent"]').first().html()).hide().fadeIn();$(document).trigger('contentChange',[$(self.contentArea)]);$(self.editLink).closest('ul.ipsList_inline').fadeIn();$(self.contentArea).closest('.ipsDataItem_main').find('.elStatusTools').fadeIn();self.fixIFrame($(self.contentArea));}).always(function(){submit.prop('disabled',false).text(currentText);});},inlineQuote:function(e){if(this._isEditing){e.stopPropagation();}},fixIFrame:function(obj){$(obj).find('div.ipsEmbeddedVideo iframe').each(function(){var url=$(this).attr("src");if(url.indexOf("?")>0){$(this).attr
({"src":url+"&wmode=transparent","wmode":"opaque"});}
else{$(this).attr
({"src":url+"?wmode=transparent","wmode":"opaque"});}});$(obj).find('div.ipsEmbeddedOther > iframe').one("load",function(e){var frame=$(this);setTimeout(function(){frame.contents().find('.fb-post').css('max-width','100%');var frame2=frame.contents().find('iframe:not(#fb_xdm_frame_http,#fb_xdm_frame_https)').first();if(frame.height()<frame2.height()){frame.css('height',frame2.height()+20);}
if(frame.width()<frame2.width()){frame.contents().find('.fb-post').css('height',frame.height()+20);frame.contents().find('.fb-post > span').css('height',frame.height()+20).css('max-width','100%').css('overflow-x','scroll');frame.css('height',frame.height()+50);}},1750);}).each(function(){if(this.complete)$(this).load();});return obj;}});}(jQuery,_));;
;(function($,_,undefined){"use strict";ips.controller.register('plugins.statusReplies',{_commentStatusID:null,_editorReady:false,_editor:null,_commentsPerPage:3,_autoUpdate:false,initialize:function(){this.setup();this.on('click','[data-page]',this.paginate);this.on('editorWidgetInitialized','[data-role="replyComment"]',this.editorReady);this.on('focus','[data-role="replyComment"] form',this.focusNewReply);this.on('submit','[data-role="replyComment"]',this.quickReply);this.on('quoteComment.comment',this.quoteComment);this.on('newComments',this.importNewComments);this.on(document,'addToStatusCommentsFeed',this.addToStatusCommentsFeed);},setup:function(){this._commentStatusID=this.scope.attr('data-statusID');this._commentsPerPage=this.scope.attr('data-perPage');this._autoUpdate=parseFloat($('#'+this.scope.closest('.ipsHovercard').attr('id').replace('_hovercard','')).closest('[data-updaterate]').attr('data-updaterate'))>0;var trigger='#'+this.scope.closest('.ipsHovercard').attr('id').replace('_hovercard','');var self=this;ips.getAjax()($(trigger).attr('href').replace('&do=statusReplies','&do=statusQuickReplyForm')+'&origin=front').done(function(response){self.scope.find('[data-role="replyComment"] > div').html(response);$(document).trigger('contentChange',[self.scope.find('[data-role="replyComment"] > div')]);});},focusNewReply:function(e){$(e.currentTarget).find('.ipsComposeArea_dummy').text(ips.getString('loading')+"...");if(!this._editorReady){setTimeout
(function(){$(e.target).focus();},100)}},editorReady:function(e,data){this._editorReady=true;try{CKEDITOR.instances[data.id].focus();}catch(err){Debug.log(err);}},paginate:function(e){e.preventDefault();var self=this;var feed=$(e.currentTarget).closest('.ipsComment_feed').find('[data-role="statusComments"]');self.scope.find('[data-role="statusFeedOverlay"]').removeClass('ipsHide');$(feed).animate({opacity:0.333},250);var paginateRow=$(e.currentTarget).closest('.sfPagination');ips.getAjax()($(e.currentTarget).attr('href')+'&origin=front').done(function(response){var data=$('<div/>').append(response);$(data).find('[data-role="statusComments"]');paginateRow.replaceWith($(data).find('.sfPagination'));feed.html($(data).find('[data-role="statusComments"]').html()).animate({opacity:1},250);feed.find('meta').remove().end();feed.attr('data-currentpage',$(e.currentTarget).attr('data-page'));$(document).trigger('contentChange',[feed]);}).fail(function(response){paginateRow.replaceWith('');ips.ui.alert.show({type:'alert',icon:'warn',message:response.responseJSON});}).always(function(){self.scope.find('[data-role="statusFeedOverlay"]').addClass('ipsHide');});},quickReply:function(e){e.preventDefault();e.stopPropagation();if(this._editor===null){this._editor=ips.ui.editor.getObj(this.scope.find('[data-role="replyComment"] [data-ipseditor]'));}
var self=this;var feed=this.scope.find('[data-role="statusComments"]');var replyArea=this.scope.find('[data-role="replyComment"]');var form=this.scope.find('[data-role="replyComment"] form');var submit=this.scope.find('[data-role="replyComment"] [type="submit"]');var page=feed.attr('data-currentpage');if(!page){page=1;}
var currentText=submit.text();submit.prop('disabled',true).text(ips.getString('saving'));ips.getAjax()(form.attr('action').replace('&do=statusReplies',''),{data:form.serialize()+'&submitting=true&currentPage='+page+'&origin=front',type:'post'}).done(function(response){self.trigger('addToStatusCommentsFeed',{content:response.content,statusID:self._commentStatusID,page:page,editor:self._editor});}).fail(function(){form.submit();}).always(function(){submit.prop('disabled',false).text(currentText);});},addToStatusCommentsFeed:function(e,data){if(!data.content||data.statusID!=this._commentStatusID||data.editor===null){return;}
var editor=data.editor;var page=data.page;var self=this;var content=$('<div/>').append(data.content);if(parseInt(page)>1){var paginateRow=this.scope.find('.sfPagination');var feed=this.scope.find('[data-role="statusComments"]');ips.getAjax()(this.scope.find('[data-page="1"]').attr('href')+'&origin=front').done(function(response){var data=$('<div/>').append(response);$(data).find('[data-role="statusComments"]');paginateRow.replaceWith($(data).find('.sfPagination'));feed.html($(data).find('[data-role="statusComments"]').html()).animate({opacity:1},250);feed.find('meta').remove().end();feed.attr('data-currentpage',1);var commentId=$(content).find('> li').attr('data-commentid');if(!commentId){commentId=feed.find('[data-commentid]').last().attr('data-commentid');}
var comment=feed.find('[data-commentid="'+commentId+'"]');comment.hide();ips.utils.anim.go('fadeInDown',comment);editor.reset();$(document).trigger('contentChange',[feed]);}).fail(function(response){paginateRow.replaceWith('');ips.ui.alert.show({type:'alert',icon:'warn',message:response.responseJSON});});}
else{var commentId=$(content).find('> li').attr('data-commentid');if(!commentId){this.scope.find('[data-commentid] [data-role="commentContent"]').last().html(content.html());content=this.scope.find('[data-commentid]').last().hide();}
else{var comment=this.scope.find('[data-commentid="'+commentId+'"]');if(comment.length){comment.remove();}
this.scope.find('[data-role="statusComments"]').append(content);}
ips.utils.anim.go('fadeInDown',content);editor.reset();$(document).trigger('contentChange',[this.scope]);}
var trigger='#'+this.scope.closest('.ipsHovercard').attr('id').replace('_hovercard','');ips.getAjax()($(trigger).attr('data-commentcount')).done(function(response){var prevCount=parseInt($(trigger).closest('[data-statusid]').attr('data-commentcount'));if(self._autoUpdate&&parseInt(response.count)>prevCount+1){var limit=parseInt(response.count)-prevCount+1;self.scope.trigger('newComments',{offset:1,limit:limit});}
var prevCount=$(trigger).closest('[data-statusid]').attr('data-commentcount',response.count);var i=$('<div/>').append($(trigger).find('i'));$(trigger).html(i.html()+' '+response.lang);});},importNewComments:function(e,data){var feed=this.scope.find('[data-role="statusComments"]');var page=feed.attr('data-currentpage');var self=this;var trigger='#'+this.scope.closest('.ipsHovercard').attr('id').replace('_hovercard','');ips.getAjax()($(trigger).attr('href').replace('statusReplies','getNewStatusReplies')+'&offset='+data.offset+'&limit='+data.limit+'&page='+page).done(function(response){if(response.pagination){var paginateRow=self.scope.find('.sfPagination');if(paginateRow.length){paginateRow.replaceWith(response.pagination);}
else{self.scope.prepend(response.pagination);}}
response=$('<div/>').append(response.content);$(response).find('[data-commentid]').each(function(){if(!feed.find('[data-commentid="'+$(this).attr('data-commentid')+'"]').length){feed.append($(this));ips.utils.anim.go('fadeInDown slow',feed.find('[data-commentid]').last());}});var removed={};var count=feed.find('[data-commentid]').length-self._commentsPerPage;feed.find('[data-commentid]').each(function(i){if(count>0&&!removed[i]){$(this).css('opacity',1).animate({opacity:0},500,function(){$(this).remove();});removed[i]=true;count--;}});});},quoteComment:function(e,data){if(!this.scope.find('[data-ipsEditor]:visible').length){this.scope.find('[data-role="replyComment"] form').focus();}
var editor=ips.ui.editor.getObj(this.scope.find('[data-ipsEditor]').first());if(editor){editor.insertQuotes([data]);}}});}(jQuery,_));;